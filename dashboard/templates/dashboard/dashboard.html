<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>UEFS - Monitoramento Agronômico</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2e7d32; /* Verde Floresta */
            --secondary: #81c784; /* Verde Claro */
            --bg: #f3f4f6;
            --card-bg: #ffffff;
            --text-main: #1f2937;
            --text-muted: #6b7280;
        }

        body { font-family: 'Inter', sans-serif; background: var(--bg); padding: 30px; margin: 0; color: var(--text-main); }
        
        /* Header */
        .header { margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center; }
        .header h1 { font-size: 24px; font-weight: 600; margin: 0; }
        .badge { background: #e8f5e9; color: var(--primary); padding: 5px 10px; border-radius: 20px; font-size: 12px; font-weight: 600; }

        /* KPIs */
        .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .kpi-card { background: var(--card-bg); padding: 20px; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); border-left: 4px solid var(--primary); }
        .kpi-title { font-size: 14px; color: var(--text-muted); margin-bottom: 5px; }
        .kpi-value { font-size: 28px; font-weight: 700; color: var(--text-main); }

        /* Gráficos Grid */
        .charts-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 20px; }
        .chart-card { background: var(--card-bg); padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .chart-header { display: flex; justify-content: space-between; margin-bottom: 15px; }
        .chart-title { font-size: 16px; font-weight: 600; }

        /* Responsividade para telas menores */
        @media (max-width: 1024px) { .charts-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

    <div class="header">
        <div>
            <h1>Dashboard de Impacto Ambiental</h1>
            <span style="font-size: 14px; color: #666;">Monitoramento em Tempo Real - Projeto UEFS</span>
        </div>
        <span class="badge">Status: Ativo</span>
    </div>

    <div class="kpi-grid">
        <div class="kpi-card">
            <div class="kpi-title">Resíduos Reciclados</div>
            <div class="kpi-value">{{ kpi_total_kg }} <span style="font-size:16px">kg</span></div>
        </div>
        <div class="kpi-card" style="border-color: #4caf50;">
            <div class="kpi-title">Melhoria do pH</div>
            <div class="kpi-value">{{ kpi_melhoria_ph }}</div>
        </div>
        <div class="kpi-card" style="border-color: #66bb6a;">
            <div class="kpi-title">Saúde Vegetal (NDVI Médio)</div>
            <div class="kpi-value">{{ kpi_media_ndvi }}</div>
        </div>
    </div>

    <div class="charts-grid">
        <div class="chart-card">
            <div class="chart-header">
                <span class="chart-title">Eficácia da Correção de Solo (pH)</span>
            </div>
            <canvas id="phChart" height="120"></canvas>
        </div>
        <div class="chart-card">
            <div class="chart-header">
                <span class="chart-title">Origem dos Resíduos (Mensal)</span>
            </div>
            <canvas id="supplierChart" height="200"></canvas>
        </div>
    </div>

    <div class="charts-grid" style="grid-template-columns: 1fr 1fr;">
        <div class="chart-card">
            <div class="chart-header">
                <span class="chart-title">Volume Aplicado por Talhão (kg)</span>
            </div>
            <canvas id="wasteChart" height="150"></canvas>
        </div>
        <div class="chart-card">
            <div class="chart-header">
                <span class="chart-title">Ranking de Vigor Vegetal (NDVI)</span>
            </div>
            <canvas id="ndviChart" height="150"></canvas>
        </div>
    </div>

    <script>
        // Configurações Globais para visual "Clean"
        Chart.defaults.font.family = "'Inter', sans-serif";
        Chart.defaults.color = '#6b7280';
        
        // 1. Gráfico de pH (Comparativo)
        new Chart(document.getElementById('phChart'), {
            type: 'bar',
            data: {
                labels: {{ labels_areas|safe }},
                datasets: [
                    {
                        label: 'pH Inicial',
                        data: {{ data_ph_pre|safe }},
                        backgroundColor: '#e0e0e0', // Cinza para o estado "ruim"
                        borderRadius: 4
                    },
                    {
                        label: 'pH Final (Pós-Tratamento)',
                        data: {{ data_ph_pos|safe }},
                        backgroundColor: '#2e7d32', // Verde forte para o sucesso
                        borderRadius: 4
                    }
                ]
            },
            options: {
                responsive: true,
                scales: { 
                    y: { min: 4, max: 7, grid: { color: '#f3f4f6' } },
                    x: { grid: { display: false } }
                }
            }
        });

        // 2. Gráfico de Pizza (Fornecedores)
        new Chart(document.getElementById('supplierChart'), {
            type: 'doughnut',
            data: {
                labels: {{ labels_fornecedores|safe }},
                datasets: [{
                    data: {{ data_residuos_fornecedores|safe }},
                    backgroundColor: ['#4caf50', '#81c784', '#a5d6a7'],
                    borderWidth: 0
                }]
            },
            options: {
                plugins: { legend: { position: 'bottom', labels: { boxWidth: 10 } } },
                cutout: '70%'
            }
        });

        // 3. Gráfico de Volume (Área)
        new Chart(document.getElementById('wasteChart'), {
            type: 'line',
            data: {
                labels: {{ labels_areas|safe }},
                datasets: [{
                    label: 'Resíduos Aplicados (kg)',
                    data: {{ data_residuos_area|safe }},
                    borderColor: '#2196f3',
                    backgroundColor: 'rgba(33, 150, 243, 0.1)',
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                plugins: { legend: { display: false } },
                scales: { y: { grid: { borderDash: [5, 5] } } }
            }
        });

        // 4. Gráfico NDVI (Horizontal)
        new Chart(document.getElementById('ndviChart'), {
            type: 'bar',
            data: {
                labels: {{ labels_areas|safe }},
                datasets: [{
                    label: 'Índice NDVI',
                    data: {{ data_ndvi|safe }},
                    backgroundColor: function(context) {
                        const value = context.raw;
                        // Gradiente de cor baseado na saúde da planta
                        return value > 0.7 ? '#1b5e20' : '#4caf50';
                    },
                    borderRadius: 4
                }]
            },
            options: {
                indexAxis: 'y', // Barra Horizontal
                plugins: { legend: { display: false } },
                scales: { x: { min: 0.5, max: 0.8 } }
            }
        });
    </script>
</body>
</html>